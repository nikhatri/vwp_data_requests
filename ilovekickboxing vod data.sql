SELECT
	videos.studioid, cloudfront_logs."DATE" AS "cloudfront_logs.start_date",
	COUNT(DISTINCT CASE WHEN ((substring((cloudfront_logs."CS_URI_STEM"), -4, 4)) = '.mp4') THEN (hash((cloudfront_logs."C_IP"), (cloudfront_logs."VIDEO_ID"), (cloudfront_logs."CS_USER_AGENT"))) ELSE NULL END) AS "cloudfront_logs.distinct_video_views"
FROM "MBO_VIRTUAL_PREP"."CLOUDFRONT_LOGS"
     AS cloudfront_logs
INNER JOIN "MBO_VIRTUAL_PREP"."VIDEOS"
     AS videos ON (cloudfront_logs."VIDEO_ID") = (videos."ID")

WHERE
((cloudfront_logs."DATE"  < (TO_DATE(DATEADD('day', 1, CURRENT_DATE())))))
and
videos.studioid in
(
  561573, 974313, 581224, 484718, 514339, 580710, 422938, 578326, 822608, 805097, 768658, 549604, 442735, 747026, 550995, 817455, 862461, 803667, 631517, 690616, 901313, 618284, 912017, 564327, 765846, 975054, 640755, 866825, 698966, 656601, 805037, 851977, 544648, 612594, 457944, 951980, 753017, 643573, 662051, 687316, 453682, 425024, 752056, 556234, 664848, 842707, 655857, 904158, 924116, 562552, 485714, 972914, 786069, 992538, 652658, 621598, 794357, 495267, 14293 , 885420, 975018, 469799, 670073, 443146, 692381, 765106, 796644, 960718, 922328, 796299, 881811, 714430, 448036, 538113, 750299, 890866, 495984, 701308, 989598
)
GROUP BY 1, 2
ORDER BY 2
LIMIT 500